//Credit to Andrew Hunt for advice on

// Keyboard constants definition
const int KEY_LEFT  = 37;
const int KEY_UP    = 38;
const int KEY_RIGHT = 39;
const int KEY_DOWN  = 40;
const int KEY_W     = 87;
const int KEY_A     = 65;
const int KEY_S     = 83;
const int KEY_D     = 68;
const int KEY_Q     = 81;
const int KEY_E     = 69;



float getKey(sampler2D channel, int key1, int key2)
{
    return texelFetch(channel, ivec2(key1, 0), 0).x + 
        texelFetch(channel, ivec2(key2, 0), 0).x;
}

void mainImage( out vec4 fragColor, in vec2 fragCoord )
{
    vec2 uv = fragCoord / iResolution.xy;
    vec4 previouscoord = texture(iChannel0,uv);
    
    float forward = getKey(iChannel1, KEY_UP, KEY_W);
    float left = getKey(iChannel1, KEY_LEFT, KEY_A);
    float back = getKey(iChannel1, KEY_DOWN, KEY_S);
    float right = getKey(iChannel1, KEY_RIGHT, KEY_D);
	float up = getKey(iChannel1, KEY_Q, KEY_Q) * 0.5;
	float down = getKey(iChannel1, KEY_E, KEY_E) * 0.5;

    fragColor = previouscoord + vec4(right - left, up - down, forward - back, 0.0) * 0.1;
}